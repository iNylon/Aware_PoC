<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ERP Simulation</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      color: #FF3300;
      margin-top: 0;
    }
    .login-section {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 6px;
      margin-bottom: 30px;
    }
    .login-form {
      display: flex;
      gap: 10px;
      align-items: end;
    }
    .form-group {
      flex: 1;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: #334155;
    }
    input, select {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #e2e8f0;
      border-radius: 4px;
      font-size: 14px;
    }
    button {
      background: #FF3300;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      margin-right: 10px;
      margin-bottom: 10px;
      font-weight: 600;
    }
    button:hover {
      background: #CC2900;
    }
    button:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }
    .output {
      background: #1e293b;
      color: #e2e8f0;
      padding: 20px;
      border-radius: 6px;
      margin-top: 20px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      max-height: 500px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .success {
      color: #10b981;
    }
    .error {
      color: #ef4444;
    }
    .info {
      color: #3b82f6;
    }
    .warning {
      color: #f59e0b;
    }
    .section {
      margin-bottom: 30px;
    }
    h2 {
      color: #334155;
      border-bottom: 2px solid #e2e8f0;
      padding-bottom: 8px;
    }
    .api-url {
      background: #f1f5f9;
      padding: 8px 12px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 14px;
      margin-bottom: 15px;
    }
    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }
    .status-logged-out {
      background: #fee2e2;
      color: #991b1b;
    }
    .status-logged-in {
      background: #d1fae5;
      color: #065f46;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üöÄ ERP Simulation</h1>
    
    <!-- Login Section -->
    <div class="login-section">
      <h2>üîê Authentication</h2>
      <div style="margin-bottom: 15px;">
        Status: <span id="loginStatus" class="status-badge status-logged-out">Not Logged In</span>
        <span id="userInfo" style="margin-left: 10px; display: none;"></span>
      </div>
      <div class="login-form" id="loginForm">
        <div class="form-group">
          <label>Username</label>
          <input type="text" id="username" value="producer1" placeholder="producer1">
        </div>
        <div class="form-group">
          <label>Password</label>
          <input type="password" id="password" value="producer1" placeholder="Password">
        </div>
        <button onclick="login()" style="margin-bottom: 0;">Login</button>
      </div>
      <button onclick="logout()" id="logoutBtn" style="display: none;">Logout</button>
    </div>
    
    <div class="section" id="batchSection" style="display: none;">
      <h2>üì¶ Batch Submission</h2>
      <p>Submit batches to the blockchain via API. These batches will have status "Pending" and require manager approval.</p>
      
      <div class="form-group" style="margin-bottom: 15px;">
        <label for="erpSelect">Select ERP System:</label>
        <select id="erpSelect" onchange="updateBatchOptions()">
          <option value="">-- Choose ERP System --</option>
          <option value="textilepro">TextilePro ERP</option>
          <option value="fiberflow">FiberFlow System</option>
          <option value="weavemaster">WeaveMaster Cloud</option>
          <option value="yarntrack">YarnTrack Enterprise</option>
          <option value="fabricforge">FabricForge ERP</option>
        </select>
      </div>
      
      <div class="form-group" style="margin-bottom: 15px;">
        <label for="batchSelect">Select Batch:</label>
        <select id="batchSelect" disabled>
          <option value="">-- First select an ERP system --</option>
        </select>
      </div>
      
      <button onclick="submitSelectedBatch()" id="submitBtn" disabled>Submit Selected Batch to Blockchain</button>
    </div>
    
    <div class="section" id="viewSection" style="display: none;">
      <h2>üîç View Batches</h2>
      <button onclick="getAllBatches()">View All Batches</button>
      <button onclick="checkSession()">Check Session</button>
    </div>
    
    <div class="output" id="output">
Click 'Login' to start...
    </div>
  </div>

  <script src="/aware-sdk.js"></script>
  <script>
    const sdk = new AwareSDK('http://localhost:3000');
    const output = document.getElementById('output');
    let currentUser = null;
    
    // ERP Batch Data
    const erpBatches = {
      textilepro: [
        { name: 'Organic Cotton Yarn - Batch #TP-2024-001', material: 'Cotton', composition: '100% Organic Cotton', weight: 5000, color: 'Natural White', colorHex: '#F5F5DC', tokenType: 'Yarn', materialSpec: '20/1s Ne' },
        { name: 'Recycled Polyester Fiber - Batch #TP-2024-002', material: 'Polyester', composition: '100% Recycled PET', weight: 3500, color: 'Navy Blue', colorHex: '#000080', tokenType: 'Fiber', materialSpec: '1.4 Denier' },
        { name: 'Bamboo Blend Yarn - Batch #TP-2024-003', material: 'Bamboo', composition: '70% Bamboo, 30% Cotton', weight: 2800, color: 'Sage Green', colorHex: '#9DC183', tokenType: 'Yarn', materialSpec: '30/1s Ne' }
      ],
      fiberflow: [
        { name: 'Merino Wool Fiber - Batch #FF-W-458', material: 'Wool', composition: '100% Merino Wool', weight: 4200, color: 'Charcoal Grey', colorHex: '#36454F', tokenType: 'Fiber', materialSpec: '19.5 Micron' },
        { name: 'Linen Yarn - Batch #FF-L-459', material: 'Linen', composition: '100% European Flax', weight: 3100, color: 'Natural Beige', colorHex: '#E8D5B7', tokenType: 'Yarn', materialSpec: '14/1s NeL' },
        { name: 'Hemp Fiber - Batch #FF-H-460', material: 'Hemp', composition: '100% Industrial Hemp', weight: 2600, color: 'Tan', colorHex: '#D2B48C', tokenType: 'Fiber', materialSpec: 'Long Fiber' }
      ],
      weavemaster: [
        { name: 'Denim Fabric - Order #WM-D-789', material: 'Cotton', composition: '98% Cotton, 2% Elastane', weight: 6800, color: 'Indigo Blue', colorHex: '#4B0082', tokenType: 'Fabric', materialSpec: 'Twill 12oz' },
        { name: 'Jersey Knit - Order #WM-J-790', material: 'Cotton', composition: '95% Cotton, 5% Spandex', weight: 4500, color: 'Black', colorHex: '#000000', tokenType: 'Fabric', materialSpec: 'Single Jersey 180gsm' },
        { name: 'Canvas Fabric - Order #WM-C-791', material: 'Cotton', composition: '100% Organic Cotton', weight: 5200, color: 'Ecru', colorHex: '#F4F0EC', tokenType: 'Fabric', materialSpec: 'Plain Weave 10oz' }
      ],
      yarntrack: [
        { name: 'Silk Yarn Production #YT-2024-Q1-15', material: 'Silk', composition: '100% Mulberry Silk', weight: 1800, color: 'Cream', colorHex: '#FFFDD0', tokenType: 'Yarn', materialSpec: '120/2 Nm' },
        { name: 'Alpaca Blend #YT-2024-Q1-16', material: 'Alpaca', composition: '80% Alpaca, 20% Merino', weight: 2200, color: 'Camel Brown', colorHex: '#C19A6B', tokenType: 'Yarn', materialSpec: '2/28 Nm' },
        { name: 'Modal Yarn #YT-2024-Q1-17', material: 'Modal', composition: '100% Beechwood Modal', weight: 3300, color: 'Soft Pink', colorHex: '#FFB6C1', tokenType: 'Yarn', materialSpec: '40/1s Ne' }
      ],
      fabricforge: [
        { name: 'Fleece Fabric Lot #FG-FL-2401', material: 'Polyester', composition: '100% Recycled Polyester', weight: 5500, color: 'Forest Green', colorHex: '#228B22', tokenType: 'Fabric', materialSpec: 'Fleece 280gsm' },
        { name: 'Satin Weave Lot #FG-ST-2402', material: 'Polyester', composition: '100% Polyester Satin', weight: 3900, color: 'Burgundy', colorHex: '#800020', tokenType: 'Fabric', materialSpec: 'Satin 120gsm' },
        { name: 'Terry Cloth Lot #FG-TC-2403', material: 'Cotton', composition: '100% Turkish Cotton', weight: 7200, color: 'White', colorHex: '#FFFFFF', tokenType: 'Fabric', materialSpec: 'Terry 400gsm' }
      ]
    };
    
    function log(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      const className = type;
      const line = `[${timestamp}] ${message}`;
      
      const span = document.createElement('span');
      span.className = className;
      span.textContent = line + '\n';
      
      output.appendChild(span);
      output.scrollTop = output.scrollHeight;
    }
    
    function clearOutput() {
      output.innerHTML = '';
    }
    
    function updateUI(loggedIn, user = null) {
      currentUser = user;
      const loginStatus = document.getElementById('loginStatus');
      const userInfo = document.getElementById('userInfo');
      const loginForm = document.getElementById('loginForm');
      const logoutBtn = document.getElementById('logoutBtn');
      const batchSection = document.getElementById('batchSection');
      const viewSection = document.getElementById('viewSection');
      
      if (loggedIn && user) {
        loginStatus.textContent = 'Logged In';
        loginStatus.className = 'status-badge status-logged-in';
        userInfo.textContent = `as ${user.username} (${getRoleLabel(user.role)})`;
        userInfo.style.display = 'inline';
        loginForm.style.display = 'none';
        logoutBtn.style.display = 'inline-block';
        
        // Only show batch submission for producers and admins
        if (user.role === 0 || user.role === 4) {
          batchSection.style.display = 'block';
        }
        viewSection.style.display = 'block';
      } else {
        loginStatus.textContent = 'Not Logged In';
        loginStatus.className = 'status-badge status-logged-out';
        userInfo.style.display = 'none';
        loginForm.style.display = 'flex';
        logoutBtn.style.display = 'none';
        batchSection.style.display = 'none';
        viewSection.style.display = 'none';
      }
    }
    
    function getRoleLabel(role) {
      const labels = {
        0: 'Producer',
        1: 'Manufacturer',
        2: 'Brand/Distributor',
        3: 'Manager/Certifier',
        4: 'Admin'
      };
      return labels[role] || 'Unknown';
    }
    
    async function login() {
      clearOutput();
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      
      log('üîê Logging in...', 'info');
      
      try {
        const result = await sdk.login(username, password);
        log('‚úÖ Login successful!', 'success');
        log(`Welcome ${result.user.username}!`, 'success');
        log(JSON.stringify(result, null, 2));
        updateUI(true, result.user);
      } catch (error) {
        log('‚ùå Login failed: ' + error.message, 'error');
        updateUI(false);
      }
    }
    
    async function logout() {
      clearOutput();
      log('üëã Logging out...', 'info');
      
      try {
        await sdk.logout();
        log('‚úÖ Logged out successfully', 'success');
        updateUI(false);
      } catch (error) {
        log('‚ùå Logout error: ' + error.message, 'error');
      }
    }
    
    async function checkSession() {
      clearOutput();
      log('üîç Checking session...', 'info');
      
      try {
        const result = await sdk.checkSession();
        if (result.loggedIn) {
          log('‚úÖ Session active', 'success');
          log(JSON.stringify(result, null, 2));
          updateUI(true, result.user);
        } else {
          log('‚ö†Ô∏è  Not logged in', 'warning');
          updateUI(false);
        }
      } catch (error) {
        log('‚ùå Session check failed: ' + error.message, 'error');
      }
    }
        function updateBatchOptions() {
      const erpSelect = document.getElementById('erpSelect');
      const batchSelect = document.getElementById('batchSelect');
      const submitBtn = document.getElementById('submitBtn');
      
      const selectedErp = erpSelect.value;
      
      if (!selectedErp) {
        batchSelect.innerHTML = '<option value="">-- First select an ERP system --</option>';
        batchSelect.disabled = true;
        submitBtn.disabled = true;
        return;
      }
      
      const batches = erpBatches[selectedErp];
      batchSelect.innerHTML = '<option value="">-- Choose a batch --</option>';
      
      batches.forEach((batch, index) => {
        const option = document.createElement('option');
        option.value = index;
        option.textContent = batch.name;
        batchSelect.appendChild(option);
      });
      
      batchSelect.disabled = false;
      batchSelect.onchange = () => {
        submitBtn.disabled = batchSelect.value === '';
      };
    }
    
    async function submitSelectedBatch() {
      const erpSelect = document.getElementById('erpSelect');
      const batchSelect = document.getElementById('batchSelect');
      
      const selectedErp = erpSelect.value;
      const selectedBatchIndex = batchSelect.value;
      
      if (!selectedErp || selectedBatchIndex === '') {
        log('‚ùå Please select both an ERP system and a batch', 'error');
        return;
      }
      
      clearOutput();
      const batchData = erpBatches[selectedErp][selectedBatchIndex];
      log(`üì¶ Submitting batch: ${batchData.name}`, 'info');
      log(`üìä Material: ${batchData.material}, Weight: ${batchData.weight}kg, Color: ${batchData.color}`, 'info');
      
      try {
        const batch = new BatchBuilder()
          .setAssetId('asset-' + Date.now())
          .setMaterial(batchData.material)
          .setComposition(batchData.composition)
          .setWeight(batchData.weight)
          .setBatchNumber(batchData.name.split('#')[1] || 'BATCH-' + Date.now())
          .setProductionDate(new Date().toLocaleDateString('en-GB'))
          .setColor(batchData.colorHex, batchData.color)
          .setProductionFacility('ERP Auto-Import')
          .setValueChain('Manufacturing', selectedErp)
          .setSustainableClaims('Traceable via ' + erpSelect.options[erpSelect.selectedIndex].text)
          .setExpiryDate('')
          .setTokenType(batchData.tokenType)
          .setMaterialSpec(batchData.materialSpec)
          .setWetProcessing('')
          .setInspector('ERP System Validation')
          .setInspectionDate(new Date().toLocaleDateString('en-GB'))
          .setSustainabilityCert('Pending')
          .build();
        
        const result = await sdk.submitBatch(batch);
        log(`‚úÖ Batch submitted successfully!`, 'success');
        log(`üìã Batch ID: ${result.batchId}`, 'success');
        log(`üìä Status: ${result.status} (awaiting manager approval)`, 'warning');
        log(JSON.stringify(result, null, 2));
      } catch (error) {
        log('‚ùå Error: ' + error.message, 'error');
      }
    }
        async function createBasicBatch() {
      clearOutput();
      log('üì¶ Creating basic batch...', 'info');
      
      try {
        const batch = new BatchBuilder()
          .setAssetId('asset-' + Date.now())
          .setBatchNumber('API-BATCH-' + Date.now())
          .setProductionDate(new Date().toLocaleDateString('en-GB'))
          .setMaterial('Cotton Yarn')
          .setMaterialSpec('16/1s')
          .setWeight(5000)
          .setComposition('100% Recycled Cotton')
          .setColor('#4CAF50', 'Green')
          .setProductionFacility('Tiancheng Factory')
          .setValueChain('Spinning', 'Ring Spinning')
          .setSustainableClaims('Recycled Material')
          .setExpiryDate('')
          .setTokenType('Yarn')
          .setWetProcessing('')
          .setInspector('Self-Validation')
          .setInspectionDate(new Date().toLocaleDateString('en-GB'))
          .setSustainabilityCert('GRS')
          .build();
        
        const result = await sdk.submitBatch(batch);
        log('‚úÖ Batch submitted successfully!', 'success');
        log(`üìã Batch ID: ${result.batchId}`, 'success');
        log(`üìä Status: ${result.status} (awaiting approval)`, 'warning');
        log(JSON.stringify(result, null, 2));
      } catch (error) {
        log('‚ùå Error: ' + error.message, 'error');
      }
    }
    
    async function createBatchWithTracer() {
      clearOutput();
      log('üî¨ Creating batch with tracer...', 'info');
      
      try {
        const batch = new BatchBuilder()
          .setAssetId('asset-tracer-' + Date.now())
          .setBatchNumber('API-TRACER-' + Date.now())
          .setProductionDate(new Date().toLocaleDateString('en-GB'))
          .setMaterial('Recycled Polyester Fiber')
          .setMaterialSpec('150D')
          .setWeight(7500)
          .setComposition('100% Recycled Polyester (Post-Consumer)')
          .setColor('#2196F3', 'Blue')
          .setProductionFacility('Tiancheng Factory')
          .setValueChain('Fiber Production', 'Recycled Fiber')
          .setSustainableClaims('Recycled, Traced')
          .setExpiryDate('')
          .setTokenType('Fiber')
          .setWetProcessing('')
          .setTracerAdded(true)
          .setTracerType('Aware')
          .setHarvestDate('15/11/2022')
          .setSupplier('GreenRecycle Ltd.')
          .setCountry('Netherlands')
          .setInspector('GuanXu')
          .setInspectionDate(new Date().toLocaleDateString('en-GB'))
          .setSustainabilityCert('GRS')
          .setFairTradeCert('Fair Trade Certified')
          .build();
        
        const result = await sdk.submitBatch(batch);
        log('‚úÖ Batch with tracer submitted!', 'success');
        log(`üìã Batch ID: ${result.batchId}`, 'success');
        log(`üìä Status: ${result.status} (awaiting approval)`, 'warning');
        log(JSON.stringify(result, null, 2));
      } catch (error) {
        log('‚ùå Error: ' + error.message, 'error');
      }
    }
    
    async function createColoredBatch() {
      clearOutput();
      log('üé® Creating colored batch...', 'info');
      
      try {
        const colors = [
          { hex: '#FF3300', name: 'Scarlet' },
          { hex: '#FFA500', name: 'Orange' },
          { hex: '#FFD700', name: 'Gold' },
          { hex: '#87CEEB', name: 'Light Blue' },
          { hex: '#FF1493', name: 'Deep Pink' }
        ];
        
        const randomColor = colors[Math.floor(Math.random() * colors.length)];
        
        const batch = new BatchBuilder()
          .setAssetId('asset-color-' + Date.now())
          .setBatchNumber('API-COLOR-' + Date.now())
          .setProductionDate(new Date().toLocaleDateString('en-GB'))
          .setMaterial('Organic Cotton Fabric')
          .setMaterialSpec('Plain Weave 150gsm')
          .setWeight(3000)
          .setComposition('100% Organic Cotton')
          .setColor(randomColor.hex, randomColor.name)
          .setProductionFacility('Sustainable Textile Mill')
          .setValueChain('Weaving', 'Plain Weave')
          .setSustainableClaims('Organic, GOTS Certified')
          .setExpiryDate('')
          .setTokenType('Fabric')
          .setWetProcessing('')
          .setInspector('Self-Validation')
          .setInspectionDate(new Date().toLocaleDateString('en-GB'))
          .setSustainabilityCert('GOTS')
          .build();
        
        const result = await sdk.submitBatch(batch);
        log(`‚úÖ ${randomColor.name} batch submitted!`, 'success');
        log(`üìã Batch ID: ${result.batchId}`, 'success');
        log(`üìä Status: ${result.status} (awaiting approval)`, 'warning');
        log(JSON.stringify(result, null, 2));
      } catch (error) {
        log('‚ùå Error: ' + error.message, 'error');
      }
    }
    
    async function getAllBatches() {
      clearOutput();
      log('üîç Fetching all batches...', 'info');
      
      try {
        const result = await sdk.getAllBatches();
        const batches = result.batches || [];
        log(`‚úÖ Found ${batches.length} batches`, 'success');
        
        // Show summary
        const pending = batches.filter(b => b.status === 0).length;
        const approved = batches.filter(b => b.status === 1).length;
        const rejected = batches.filter(b => b.status === 2).length;
        
        log(`üìä Pending: ${pending}, Approved: ${approved}, Rejected: ${rejected}`, 'info');
        log(JSON.stringify(batches, null, 2));
      } catch (error) {
        log('‚ùå Error: ' + error.message, 'error');
      }
    }
    
    // Check session on load
    window.addEventListener('load', async () => {
      log('‚ú® Aware API SDK loaded!', 'success');
      await checkSession();
    });
  </script>
</body>
